# Economics A-Level Past Paper Parsing System

A comprehensive system for parsing Economics A-level past paper PDFs, extracting text and images with layout preservation, and displaying them with 1:1 accuracy in a modern web interface.

## âœ¨ Features

- **PDF Parsing**: Extract text, images, diagrams, and layout information from past paper PDFs
- **Intelligent Question Segmentation**: Automatically detect and split questions (handles formats like 1, 2a, 3b(i), etc.)
- **Layout Preservation**: Maintain original PDF formatting for accurate reproduction
- **Image Extraction**: Extract and store diagrams, graphs, and images from PDFs
- **Modern UI**: Clean, responsive interface for viewing parsed questions
- **Scalable Architecture**: Built to handle hundreds of papers without performance degradation

## ğŸ› ï¸ Tech Stack

**All technologies are 100% free and open-source:**

- **Backend**: Python 3.11+, FastAPI, PyMuPDF (PDF parsing)
- **Database**: PostgreSQL via Supabase (free tier)
- **Storage**: Supabase Storage (free tier for images)
- **Frontend**: Next.js 14, React, TypeScript
- **ORM**: Prisma

## ğŸ“ Project Structure

```
parsing-project/
â”œâ”€â”€ parsing-api/          # Python FastAPI backend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py      # FastAPI app
â”‚   â”‚   â”œâ”€â”€ config.py    # Configuration
â”‚   â”‚   â”œâ”€â”€ models/      # Pydantic models
â”‚   â”‚   â”œâ”€â”€ services/    # PDF parsing logic
â”‚   â”‚   â”œâ”€â”€ utils/       # Storage utilities
â”‚   â”‚   â””â”€â”€ routers/     # API endpoints
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ .env.example
â”œâ”€â”€ app/                  # Next.js frontend
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx         # Upload page
â”‚   â”œâ”€â”€ papers/[paperId]/
â”‚   â”‚   â””â”€â”€ page.tsx     # Paper viewer
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ components/          # React components
â”‚   â”œâ”€â”€ ContentElement.tsx
â”‚   â”œâ”€â”€ QuestionRenderer.tsx
â”‚   â””â”€â”€ PaperViewer.tsx
â”œâ”€â”€ lib/                # Utility functions
â”‚   â””â”€â”€ api.ts          # API client
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma   # Database schema
â””â”€â”€ package.json
```

## ğŸš€ Setup Instructions

### Prerequisites

- Node.js 18+ and npm
- Python 3.11+
- Supabase account (free)

### 1. Supabase Setup

1. Create a free account at [supabase.com](https://supabase.com)
2. Create a new project
3. Go to **Project Settings** â†’ **API** and copy:
   - Project URL
   - `anon` public key
   - `service_role` secret key
4. Go to **SQL Editor** and run the following to create tables:

```sql
-- This will be generated by Prisma, but you can run it manually:
-- See prisma/schema.prisma for the complete schema
```

5. Go to **Storage** and create a bucket named `question-images` with public access

### 2. Backend Setup (Python API)

```bash
# Navigate to the parsing-api directory
cd parsing-api

# Create virtual environment
python -m venv venv

# Activate virtual environment
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Copy and configure environment variables
copy .env.example .env
# Edit .env and add your Supabase credentials:
# SUPABASE_URL=your_project_url
# SUPABASE_KEY=your_anon_key
# SUPABASE_SERVICE_KEY=your_service_role_key

# Run the API
python -m app.main
```

The API will run on `http://localhost:8000`. Visit `http://localhost:8000/docs` for API documentation.

### 3. Frontend Setup (Next.js)

```bash
# Navigate to the project root
cd ..

# Install dependencies
npm install

# Copy and configure environment variables
copy .env.example .env
# Edit .env and add:
# DATABASE_URL=your_supabase_postgres_connection_string
# NEXT_PUBLIC_API_URL=http://localhost:8000

# Generate Prisma client
npx prisma generate

# Push database schema to Supabase
npx prisma db push

# Run the development server
npm run dev
```

The frontend will run on `http://localhost:3000`.

## ğŸ“– Usage

### Uploading a Past Paper

1. Open `http://localhost:3000` in your browser
2. Click "Select PDF File" and choose an Economics A-level past paper
3. Fill in the metadata:
   - Exam Board (AQA, Edexcel, OCR, WJEC)
   - Year
   - Session (June, November, January)
   - Paper Number (1, 2, 3)
4. Click "Upload & Parse PDF"
5. Wait for processing (typically 5-15 seconds depending on paper size)
6. You'll be redirected to the parsed paper view

### Viewing Parsed Papers

- After upload, you'll see all questions rendered with their original layout
- Questions maintain their numbering (1, 2a, 3b(i), etc.)
- Images and diagrams are displayed in their correct positions
- Mark allocations are shown next to each question

## ğŸ”Œ API Endpoints

### POST `/api/parse/upload`

Upload and parse a PDF file.

**Request:**
- `file`: PDF file (multipart/form-data)
- `metadata`: JSON string with paper metadata

```json
{
  "examBoard": "AQA",
  "subject": "Economics",
  "level": "A-Level",
  "year": 2023,
  "session": "June",
  "paperNumber": 1
}
```

**Response:**
```json
{
  "paperId": "uuid",
  "status": "success",
  "questionsCount": 25,
  "processingTime": 4.2
}
```

### GET `/api/parse/papers/{paperId}`

Retrieve a parsed paper with all questions.

**Response:**
```json
{
  "id": "uuid",
  "title": "AQA Economics A-Level Paper 1 - June 2023",
  "questions": [...]
}
```

### GET `/api/parse/health`

Health check endpoint.

## ğŸ”§ Configuration

### Backend Configuration (parsing-api/.env)

```env
SUPABASE_URL=your_supabase_project_url
SUPABASE_KEY=your_supabase_anon_key
SUPABASE_SERVICE_KEY=your_supabase_service_role_key
STORAGE_BUCKET=question-images
API_HOST=0.0.0.0
API_PORT=8000
```

### Frontend Configuration (.env)

```env
NEXT_PUBLIC_API_URL=http://localhost:8000
DATABASE_URL=postgresql://user:password@host:port/database?schema=public
```

## ğŸš€ Deployment

### Backend Deployment Options (Free Forever)

**Option 1: Vercel Serverless Functions (Recommended - Free Forever)**

Vercel's free tier is permanent and includes serverless functions. You can deploy the FastAPI backend as API routes:

1. Create `api/` folder in project root
2. Create `api/parse.py` with FastAPI code
3. Add `vercel.json`:
```json
{
  "builds": [
    { "src": "api/**/*.py", "use": "@vercel/python" }
  ],
  "routes": [
    { "src": "/api/(.*)", "dest": "api/$1" }
  ]
}
```
4. Deploy to Vercel alongside the frontend
5. **Pros**: Free forever, auto-scaling, same platform as frontend
6. **Cons**: Cold starts, limited execution time (10s free tier)

**Option 2: Supabase Edge Functions (Free Forever)**

Since you're already using Supabase, deploy parsing as Edge Functions:

1. Rewrite parsing logic in TypeScript/Deno (Supabase Edge Functions use Deno)
2. Deploy via Supabase CLI: `supabase functions deploy parse-pdf`
3. Free within Supabase's generous limits (500K function invocations/month)
4. **Pros**: Integrated with your database, free forever, fast
5. **Cons**: Need to rewrite Python code in TypeScript

**Option 3: Self-Hosting (Free Forever)**

Run the backend on your own hardware:

1. **Local Machine**: Run `python -m app.main` and use ngrok/Cloudflare Tunnel for public access
2. **Raspberry Pi**: Low-power server running 24/7
3. **Old PC/Laptop**: Repurpose as server with Ubuntu + FastAPI
4. **Pros**: Complete control, no vendor lock-in, truly unlimited
5. **Cons**: Requires managing your own infrastructure, uptime depends on you

**Option 4: Oracle Cloud Free Tier (Free Forever)**

Oracle Cloud has a genuinely free-forever tier with 2 VMs:

1. Create Oracle Cloud account
2. Create a VM (ARM-based Ampere - free forever)
3. Install Python, FastAPI, run as systemd service
4. **Pros**: Real VM, 24GB RAM, free forever
5. **Cons**: More complex setup, need to manage Linux server

**Option 5: PythonAnywhere (Free Forever with Limits)**

Forever-free tier for small Python apps:

1. Create account at [pythonanywhere.com](https://pythonanywhere.com)
2. Upload code via web interface
3. Configure WSGI/ASGI
4. **Pros**: Easy setup, Python-focused
5. **Cons**: Limited to 1 web app, 512MB storage, some restrictions

### Frontend Deployment

**Vercel (Free Forever)**
1. Create account at [vercel.com](https://vercel.com)
2. Import your GitHub repository
3. Add environment variables
4. Deploy (automatic)
5. **Limits**: 100GB bandwidth/month, unlimited deployments

**Cloudflare Pages (Free Forever - Alternative)**
1. Create account at [cloudflare.com](https://cloudflare.com)
2. Connect GitHub repository
3. Build command: `npm run build`
4. Output directory: `.next`
5. **Limits**: Unlimited bandwidth, unlimited deploys

### Recommended Setup for Free Forever

**Easiest**: Vercel (frontend + backend as serverless functions)
- Everything in one place
- Auto-deploys from Git
- Free forever
- Good for low-to-medium traffic

**Most Powerful**: Vercel (frontend) + Oracle Cloud (backend)
- Full VM for backend
- Unlimited processing time
- Can handle heavy PDFs
- Free forever

**Most Integrated**: Vercel (frontend) + Supabase Edge Functions (backend)
- All services in Supabase ecosystem
- Fast data access
- Free forever
- Requires TypeScript rewrite

## ğŸ“Š Database Schema

See `prisma/schema.prisma` for the complete schema. Key models:

- **Paper**: Stores past paper metadata
- **Question**: Individual questions within a paper
- **QuestionContent**: Content elements (text, images) within questions

## ğŸ¤ Contributing

This is a project template. Feel free to:
- Add support for more subjects
- Improve question segmentation algorithm
- Add OCR for scanned PDFs
- Implement question search functionality
- Add user authentication

## ğŸ“„ License

This project uses open-source libraries with their respective licenses:
- PyMuPDF (AGPL)
- FastAPI (MIT)
- Next.js (MIT)
- Prisma (Apache 2.0)

## ğŸ› Troubleshooting

### "Failed to upload PDF"
- Check that the backend API is running
- Verify CORS settings in `app/main.py`
- Check file size (recommend < 50MB)

### "Failed to load paper"
- Verify database connection string
- Check that Prisma schema is pushed to database
- Run `npx prisma generate` to update client

### Images not loading
- Verify Supabase storage bucket is public
- Check `STORAGE_BUCKET` environment variable
- Ensure Supabase service key has storage permissions

## ğŸ“ Support

For issues or questions:
1. Check the API docs at `http://localhost:8000/docs`
2. Review error logs in terminal
3. Verify environment variables are set correctly

---

Built with â¤ï¸ using free, open-source technologies
